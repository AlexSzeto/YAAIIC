<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom UI Component Test Page</title>
  
  <!-- Import Map for bare module specifiers -->
  <script type="importmap">
    {
      "imports": {
        "preact": "https://esm.sh/preact@10.19.2",
        "preact/": "https://esm.sh/preact@10.19.2/",
        "preact/hooks": "https://esm.sh/preact@10.19.2/hooks",
        "htm/preact": "https://esm.sh/htm@3.1.1/preact?external=preact",
        "goober": "https://esm.sh/goober@2.1.14?external=preact"
      }
    }
  </script>
  
  <!-- Box Icons for icon support -->
  <script src="https://unpkg.com/boxicons@latest/dist/boxicons.js"></script>
</head>
<body>
  <div id="app"></div>
  
  <script type="module">
    import { html, render, Component } from 'htm/preact';
    import { styled, css } from './goober-setup.mjs';
    import { Page } from './page.mjs';
    import { currentTheme, toggleTheme } from './theme.mjs';
    import { Button } from './button.mjs';
    import { Panel } from './panel.mjs';
    import { Input } from './input.mjs';
    import { Select } from './select.mjs';
    import { Textarea } from './textarea.mjs';
    import { Checkbox } from './checkbox.mjs';
    import { ButtonGroup } from './button-group.mjs';
    import { PaginationControls } from './pagination.mjs';
    import { ImageCarousel } from './image-carousel.mjs';
    import { ItemNavigator } from './item-navigator.mjs';
    import { showListSelect } from './list-select.mjs';
    
    // =========================================================================
    // Styled Components
    // =========================================================================
    
    /**
     * Main container for the test page content
     */
    const Container = styled('div')`
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
    `;
    
    /**
     * Header with flex layout for title and theme toggle
     */
    const Header = styled('header')`
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    `;
    
    /**
     * Page title with no margin (handled by Header)
     */
    const Title = styled('h1')`
      margin: 0;
    `;
    
    /**
     * Muted text paragraph
     */
    const MutedText = styled('p')`
      margin-bottom: 24px;
      opacity: 0.7;
    `;
    
    /**
     * Section container with bottom margin
     */
    const Section = styled('section')`
      margin-bottom: 48px;
    `;
    
    /**
     * Section title with bottom border
     */
    const SectionTitle = styled('h2')`
      border-bottom: 1px solid currentColor;
      padding-bottom: 8px;
      opacity: 0.5;
    `;
    
    /**
     * Flex container for component demos
     */
    const ComponentGrid = styled('div')`
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 16px;
    `;
    
    /**
     * Placeholder text for coming soon sections
     */
    const ComingSoon = styled('p')`
      opacity: 0.6;
    `;
    
    // =========================================================================
    // Test Application
    // =========================================================================
    
    /**
     * TestApp - Main test page application component
     * Displays all custom UI components with various states for testing
     */
    class TestApp extends Component {
      constructor(props) {
        super(props);
        this.state = {
          themeName: currentTheme.value.name,
          // Checkbox states
          checkbox1: false,
          checkbox2: true,
          checkbox3: true,
          // ButtonGroup states
          selectedTags: ['tag2'],
          // Pagination state
          paginationPage: 0,
          // ItemNavigator state
          navigatorItems: [
            { id: '1', name: 'Image 1' },
            { id: '2', name: 'Image 2' },
            { id: '3', name: 'Image 3' },
            { id: '4', name: 'Image 4' },
            { id: '5', name: 'Image 5' }
          ],
          navigatorSelected: null,
          // ImageCarousel state (deprecated, kept for compatibility testing)
          carouselItems: [
            { id: '1', name: 'Item A' },
            { id: '2', name: 'Item B' },
            { id: '3', name: 'Item C' }
          ],
          carouselSelected: null
        };
      }
      
      componentDidMount() {
        // Subscribe to theme changes
        this.unsubscribe = currentTheme.subscribe((theme) => {
          this.setState({ themeName: theme.name });
        });
      }
      
      componentWillUnmount() {
        if (this.unsubscribe) {
          this.unsubscribe();
        }
      }
      
      handleToggleTheme = () => {
        toggleTheme();
      };
      
      handleCheckbox = (key) => () => {
        this.setState(prev => ({ [key]: !prev[key] }));
      };
      
      handleTagSelect = (id) => {
        this.setState(prev => ({
          selectedTags: prev.selectedTags.includes(id)
            ? prev.selectedTags.filter(t => t !== id)
            : [...prev.selectedTags, id]
        }));
      };
      
      handlePaginationPrev = () => {
        this.setState(prev => ({ paginationPage: Math.max(0, prev.paginationPage - 1) }));
      };
      
      handlePaginationNext = () => {
        this.setState(prev => ({ paginationPage: Math.min(4, prev.paginationPage + 1) }));
      };
      
      handleNavigatorSelect = (item) => {
        this.setState({ navigatorSelected: item });
      };
      
      handleCarouselSelect = (item) => {
        this.setState({ carouselSelected: item });
      };
      
      render() {
        const { themeName } = this.state;
        
        return html`
          <${Page}>
            <${Container}>
              <${Header}>
                <${Title}>Custom UI Component Test Page<//>
                <${Button} 
                  variant="medium-icon-text"
                  color="primary" 
                  icon=${themeName === 'dark' ? 'sun' : 'moon'}
                  onClick=${this.handleToggleTheme}
                >
                  ${themeName === 'dark' ? 'Light Mode' : 'Dark Mode'}
                <//>
              <//>
              
              <${MutedText}>
                Current theme: <strong>${themeName}</strong>
              <//>
              
              <!-- Component Sections -->
              <${Section}>
                <${SectionTitle}>Page Component<//>
                <p>The Page component provides global styles including:</p>
                <ul>
                  <li>Font family (Arial, sans-serif)</li>
                  <li>Background color from theme</li>
                  <li>Text color from theme</li>
                  <li>CSS reset / base styles</li>
                  <li>Custom scrollbar styling</li>
                </ul>
              <//>
              
              <${Section}>
                <${SectionTitle}>Button Component</${SectionTitle}>
                <p style="margin-bottom: 16px; opacity: 0.7;">All button variants with color themes</p>
                
                <h4 style="margin: 16px 0 8px;">Medium Text Buttons (default)</h4>
                <${ComponentGrid}>
                  <${Button} color="primary">Primary<//>
                  <${Button} color="secondary">Secondary<//>
                  <${Button} color="success">Success<//>
                  <${Button} color="danger">Danger<//>
                  <${Button} color="primary" disabled=${true}>Disabled<//>
                  <${Button} color="primary" loading=${true}>Loading<//>
                <//>
                
                <h4 style="margin: 16px 0 8px;">Medium Icon-Text Buttons</h4>
                <${ComponentGrid}>
                  <${Button} variant="medium-icon-text" icon="play" color="primary">Play<//>
                  <${Button} variant="medium-icon-text" icon="save" color="success">Save<//>
                  <${Button} variant="medium-icon-text" icon="trash" color="danger">Delete<//>
                  <${Button} variant="medium-icon-text" icon="cog" color="secondary">Settings<//>
                <//>
                
                <h4 style="margin: 16px 0 8px;">Medium Icon-Only Buttons</h4>
                <${ComponentGrid}>
                  <${Button} variant="medium-icon" icon="play" color="primary" title="Play" />
                  <${Button} variant="medium-icon" icon="pause" color="secondary" title="Pause" />
                  <${Button} variant="medium-icon" icon="check" color="success" title="Confirm" />
                  <${Button} variant="medium-icon" icon="x" color="danger" title="Close" />
                <//>
                
                <h4 style="margin: 16px 0 8px;">Small Text Buttons (tag-style)</h4>
                <${ComponentGrid}>
                  <${Button} variant="small-text" color="primary">Tag Primary<//>
                  <${Button} variant="small-text" color="secondary">Tag Secondary<//>
                  <${Button} variant="small-text" color="success">Tag Success<//>
                  <${Button} variant="small-text" color="danger">Tag Danger<//>
                <//>
                
                <h4 style="margin: 16px 0 8px;">Small Icon-Only Buttons</h4>
                <${ComponentGrid}>
                  <${Button} variant="small-icon" icon="copy" color="secondary" title="Copy" />
                  <${Button} variant="small-icon" icon="edit" color="primary" title="Edit" />
                  <${Button} variant="small-icon" icon="refresh" color="success" title="Refresh" />
                  <${Button} variant="small-icon" icon="trash" color="danger" title="Delete" />
                <//>
              <//>
              
              <${Section}>
                <${SectionTitle}>Panel Component</${SectionTitle}>
                <${ComponentGrid}>
                  <${Panel}>
                    <strong>Default Panel</strong>
                    <p>Solid background with subtle border.</p>
                  <//>
                  <${Panel} variant="elevated">
                    <strong>Elevated Panel</strong>
                    <p>Raised appearance with shadow, no border.</p>
                  <//>
                  <${Panel} variant="outlined">
                    <strong>Outlined Panel</strong>
                    <p>Transparent background with prominent border.</p>
                  <//>
                  <div style="position: relative; background: linear-gradient(45deg, #007bff, #28a745); padding: 20px; border-radius: 8px;">
                    <${Panel} variant="glass">
                      <strong>Glass Panel</strong>
                      <p>Semi-transparent with blur effect.</p>
                    <//>
                  </div>
                </>
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>Input Component</${SectionTitle}>
                <${ComponentGrid}>
                  <${Input} label="Basic Input" name="basic" placeholder="Enter text..." />
                  <${Input} label="With Value" name="withValue" value="Hello World" />
                  <${Input} label="Disabled" name="disabled" disabled=${true} value="Cannot edit" />
                  <${Input} label="With Error" name="error" error="This field is required" />
                <//>
                <div style="margin-top: 16px;">
                  <${Input} label="Full Width Input" name="fullWidth" fullWidth=${true} placeholder="This spans the full width..." />
                </div>
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>Select Component</${SectionTitle}>
                <${ComponentGrid}>
                  <${Select} 
                    label="Basic Select" 
                    name="basic"
                    options=${[
                      { label: 'Option 1', value: '1' },
                      { label: 'Option 2', value: '2' },
                      { label: 'Option 3', value: '3' }
                    ]} 
                  />
                  <${Select} 
                    label="With Selection" 
                    name="selected"
                    value="2"
                    options=${[
                      { label: 'First', value: '1' },
                      { label: 'Second', value: '2' },
                      { label: 'Third', value: '3' }
                    ]} 
                  />
                  <${Select} 
                    label="Disabled" 
                    name="disabled"
                    disabled=${true}
                    options=${[{ label: 'Cannot change', value: '1' }]} 
                  />
                  <${Select} 
                    label="With Error" 
                    name="error"
                    error="Please select an option"
                    options=${[{ label: 'Choose...', value: '' }]} 
                  />
                <//>
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>Textarea Component</${SectionTitle}>
                <${ComponentGrid}>
                  <${Textarea} label="Basic Textarea" name="basic" placeholder="Enter text here..." />
                  <${Textarea} label="With Value" name="withValue" value="Some existing content that spans multiple lines for demonstration purposes." />
                  <${Textarea} label="Disabled" name="disabled" disabled=${true} value="Cannot edit this content" />
                  <${Textarea} label="With Error" name="error" error="This field is required" />
                </${ComponentGrid}>
                <div style="margin-top: 16px;">
                  <${Textarea} label="Full Width Textarea (default)" name="fullWidth" placeholder="This spans the full width by default..." rows=${6} />
                </div>
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>Checkbox Component</${SectionTitle}>
                <${ComponentGrid}>
                  <${Checkbox} label="Click to toggle" checked=${this.state.checkbox1} onChange=${this.handleCheckbox('checkbox1')} />
                  <${Checkbox} label="Initially checked" checked=${this.state.checkbox2} onChange=${this.handleCheckbox('checkbox2')} />
                  <${Checkbox} label="Disabled Unchecked" disabled=${true} />
                  <${Checkbox} label="Disabled Checked" checked=${true} disabled=${true} />
                  <${Checkbox} label="Label on Left" labelPosition="left" checked=${this.state.checkbox3} onChange=${this.handleCheckbox('checkbox3')} />
                  <${Checkbox} checked=${this.state.checkbox1} onChange=${this.handleCheckbox('checkbox1')} />
                </${ComponentGrid}>
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>ButtonGroup Component</${SectionTitle}>
                <p style="margin-bottom: 16px; opacity: 0.7;">Click buttons to toggle selection</p>
                <${ButtonGroup}
                  items=${[
                    { id: 'tag1', name: 'Option A' },
                    { id: 'tag2', name: 'Option B' },
                    { id: 'tag3', name: 'Option C' },
                    { id: 'tag4', name: 'Long Option Name' }
                  ]}
                  selected=${this.state.selectedTags}
                  onSelect=${this.handleTagSelect}
                />
                <h4 style="margin: 16px 0 8px;">Medium Variant</h4>
                <${ButtonGroup}
                  items=${[
                    { id: 'a', name: 'First' },
                    { id: 'b', name: 'Second' },
                    { id: 'c', name: 'Third' }
                  ]}
                  selected=${['a']}
                  variant="medium-text"
                />
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>Pagination Component</${SectionTitle}>
                <p style="margin-bottom: 16px; opacity: 0.7;">Interactive pagination controls</p>
                <${PaginationControls}
                  currentPage=${this.state.paginationPage}
                  totalPages=${5}
                  onPrev=${this.handlePaginationPrev}
                  onNext=${this.handlePaginationNext}
                />
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>ItemNavigator Component (NEW)</${SectionTitle}>
                <p style="margin-bottom: 16px; opacity: 0.7;">Unified navigation component replacing ImageCarousel and item-centric pagination</p>
                
                <h4 style="margin: 16px 0 8px;">Basic Navigation</h4>
                <${ItemNavigator}
                  items=${this.state.navigatorItems}
                  selectedItem=${this.state.navigatorSelected || this.state.navigatorItems[0]}
                  onSelect=${this.handleNavigatorSelect}
                />
                <p style="margin-top: 8px; opacity: 0.7; font-size: 12px;">
                  Selected: ${(this.state.navigatorSelected || this.state.navigatorItems[0])?.name}
                </p>
                
                <h4 style="margin: 16px 0 8px;">With First/Last Buttons</h4>
                <${ItemNavigator}
                  items=${this.state.navigatorItems}
                  selectedItem=${this.state.navigatorSelected || this.state.navigatorItems[0]}
                  onSelect=${this.handleNavigatorSelect}
                  showFirstLast=${true}
                />
                
                <h4 style="margin: 16px 0 8px;">With Keyboard Navigation (click to focus, use arrow keys)</h4>
                <${ItemNavigator}
                  items=${this.state.navigatorItems}
                  selectedItem=${this.state.navigatorSelected || this.state.navigatorItems[0]}
                  onSelect=${this.handleNavigatorSelect}
                  enableKeyboard=${true}
                />
                
                <h4 style="margin: 16px 0 8px;">Empty State</h4>
                <${ItemNavigator}
                  items=${[]}
                  selectedItem=${null}
                  onSelect=${() => {}}
                  emptyMessage="No images available"
                />
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>ImageCarousel Component (Deprecated)</${SectionTitle}>
                <p style="margin-bottom: 16px; opacity: 0.7;">Legacy wrapper for backwards compatibility - now uses ItemNavigator internally</p>
                <${ImageCarousel}
                  items=${this.state.carouselItems}
                  selectedItem=${this.state.carouselSelected || this.state.carouselItems[0]}
                  onSelect=${this.handleCarouselSelect}
                />
                <p style="margin-top: 8px; opacity: 0.7; font-size: 12px;">
                  Selected: ${(this.state.carouselSelected || this.state.carouselItems[0])?.name}
                </p>
              </${Section}>
              
              <${Section}>
                <${SectionTitle}>ListSelect Component</${SectionTitle}>
                <p style="margin-bottom: 16px; opacity: 0.7;">Modal list selection with optional actions</p>
                
                <${ComponentGrid}>
                  <${Button} 
                    variant="medium-icon-text" 
                    icon="list-ul" 
                    color="primary"
                    onClick=${() => {
                      showListSelect({
                        title: 'Select Item',
                        items: [
                          { id: '1', label: 'Option 1' },
                          { id: '2', label: 'Option 2' },
                          { id: '3', label: 'Option 3' },
                          { id: '4', label: 'Disabled Option', disabled: true }
                        ],
                        itemIcon: 'check-circle',
                        onSelectItem: (item) => {
                          console.log('Selected:', item);
                        }
                      });
                    }}
                  >
                    Basic List Select
                  <//>
                  
                  <${Button} 
                    variant="medium-icon-text" 
                    icon="folder" 
                    color="secondary"
                    onClick=${() => {
                      showListSelect({
                        title: 'Select Folder',
                        items: [
                          { id: 'f1', label: 'Documents', icon: 'folder' },
                          { id: 'f2', label: 'Images', icon: 'folder' },
                          { id: 'f3', label: 'Videos', icon: 'folder' }
                        ],
                        onSelectItem: (item) => {
                          console.log('Selected folder:', item);
                        }
                      });
                    }}
                  >
                    Folder Select
                  <//>
                  
                  <${Button} 
                    variant="medium-icon-text" 
                    icon="cog" 
                    color="success"
                    onClick=${() => {
                      showListSelect({
                        title: 'Manage Items',
                        items: [
                          { id: 'i1', label: 'Editable Item 1', icon: 'file' },
                          { id: 'i2', label: 'Editable Item 2', icon: 'file' },
                          { id: 'i3', label: 'Protected Item', icon: 'lock-alt', disabled: true }
                        ],
                        showActions: true,
                        actionLabel: 'New Item',
                        onSelectItem: (item) => {
                          console.log('Selected:', item);
                        },
                        onEdit: (item) => {
                          console.log('Edit:', item);
                        },
                        onDelete: (item) => {
                          console.log('Delete:', item);
                        },
                        onAction: () => {
                          console.log('Create new item');
                        }
                      });
                    }}
                  >
                    With Actions
                  <//>
                  
                  <${Button} 
                    variant="medium-icon-text" 
                    icon="loader" 
                    color="secondary"
                    onClick=${() => {
                      showListSelect({
                        title: 'Loading State',
                        items: [],
                        emptyMessage: 'Loading...'
                      });
                    }}
                  >
                    Loading State
                  </>
                  
                  <${Button} 
                    variant="medium-icon-text" 
                    icon="x-circle" 
                    color="secondary"
                    onClick=${() => {
                      showListSelect({
                        title: 'Empty List',
                        items: []
                      });
                    }}
                  >
                    Empty State
                  <//>
                <//>
              </${Section}>
              
              <!-- More component sections will be added as they are refactored -->
              
            <//>
          <//>
        `;
      }
    }
    
    // Render the test app
    render(html`<${TestApp} />`, document.getElementById('app'));
  </script>
</body>
</html>
