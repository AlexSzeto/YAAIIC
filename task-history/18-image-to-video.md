# Image to Video

## Goal
Add server and UI support for image to video workflows.

[x] (Server) Hard code two workflow parameters, `frames` (set to 21), and `framerate` (set to 20) to be replaced later.

1. Locate the workflow replacement logic in `server/generate.mjs`
2. Add `frames` and `framerate` as hardcoded workflow parameters with values 21 and 20 respectively
3. Ensure these parameters are injected into the workflow before execution

[x] (Server) Add support for the workflow replace parameter `saveFilename` (which extracts the filename portion of `savePath`, without the folder path or the extension) and `storagePath` (the absolute system path to the project's `/storage` folder)

1. Locate the workflow parameter replacement logic in `server/generate.mjs`
2. Add `saveFilename` parameter that extracts the filename from `savePath` (without folder path or extension)
3. Add `storagePath` parameter that resolves to the absolute path of the `/storage` folder
4. Ensure both parameters are available for workflow template substitution

[x] (Server) Add support for the `extractOutputPathFromTextFile` parameter, which opens the specified filename (located inside the project's `/storage` folder), and retrieve the full path to the file generated by the workflow. It would then copy the file generated into the originally intended `savePath` before proceeding with the text generation steps (if any).

1. Create a utility function in `server/util.mjs` to read a text file from the `/storage` folder and extract the output path
2. Locate the workflow execution and post-processing logic in `server/generate.mjs`
3. When `extractOutputPathFromTextFile` is specified, read the output path from the referenced file after workflow completes
4. Copy the generated file from the extracted path to the `savePath` location
5. Proceed with subsequent text generation steps if configured

[x] (Server, Client) Rename the workflow type `txt2img` as `image`, and update all related static references to the label.

1. Search for all references to `txt2img` workflow type in `server/` directory
2. Search for all references to `txt2img` in workflow configuration files in `server/resource/`
3. Search for all references to `txt2img` in `public/js/` client-side files
4. Rename `txt2img` to `image` in all workflow definitions
5. Update client-side references and UI labels
6. Verify configuration files use the new `image` type

[x] (Client) Add support for `type: "video"` on the client main UI. Treat the workflow identically to image workflows except to enable two more number form values between the existing `Name` and `Seed` fields: `Length` (in seconds, sent to the server as `frames`, which is `length*framerate`), and `Frame Rate` (sent to the server as `framerate`)

1. Locate the workflow type configuration in `public/js/main.mjs` or appropriate setup file
2. Add `type: "video"` support alongside `image` type workflows
3. Identify the form field rendering logic for workflow parameters in `public/js/`
4. Add two new number input fields: `Length` (in seconds, default to 1.0) and `Frame Rate` (in fps, default to 20)
5. Position these fields between the `Name` and `Seed` fields in the form
6. Implement client-side calculation logic to convert `floor(Length * Frame Rate) = frames` before sending to server
7. Update any workflow setup/initialization files to register video workflow types
